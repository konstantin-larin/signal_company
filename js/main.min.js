const html=document.documentElement,header=document.getElementById("header"),headerNav=document.getElementById("headerNav"),navbarToggler=document.getElementById("navbar-toggler"),headerRutubeLogo=document.getElementById("header-rutube-logo"),headerLogo=document.getElementById("header-logo"),mainSection=document.getElementById("main"),mainScrollBtn=document.getElementById("main-scroll-btn"),SECTIONS=Array.from(document.querySelectorAll(".section"));SECTIONS.push(mainSection);const videosSection=document.getElementById("videos"),videoCards=Array.from(document.querySelectorAll(".videos__video-card")),videoRow=document.querySelector(".videos__video-row"),videoRowWrapper=videoRow.closest(".videos__video-row-wrapper"),modalWindow=document.getElementById("modal-window"),partnersRow=document.getElementById("partners-row"),footerMap=document.getElementById("footer-map"),phoneInputs=Array.from(document.querySelectorAll(".js-phone-input")),feedback=document.getElementById("feedback");let navIsReady=!0;function headerShrink(){this.pageYOffset>0?header.classList.add("header-shrink-pad"):header.classList.remove("header-shrink-pad")}function backDefaultNavbar(){html.classList.remove("overflow-hidden"),navbarToggler.classList.remove("color-transition"),navbarToggler.classList.remove("bg-to-red"),navbarToggler.classList.remove("burger-to-cross"),headerNav.classList.remove("show"),header.classList.add("sticky-top"),header.classList.remove("fixed-stretch"),header.querySelector(".container-xl").append(headerRutubeLogo),headerRutubeLogo.classList.remove("rutube-logo_mobile"),headerNav.querySelector(".navbar-nav").classList.remove("align-items-center"),headerLogo.classList.remove("flex-grow-1"),headerLogo.style.marginRight="",navIsReady=!0}function headerMobileNavbarBehaviour(){if(headerNav.classList.contains("show"))headerNav.classList.add("opacity-0"),headerNav.ontransitionend=backDefaultNavbar,setTimeout(()=>{navIsReady||backDefaultNavbar()},1e3);else{if(headerNav.classList.contains("show")||!navIsReady)return;headerNav.ontransitionend="",navIsReady=!1,html.classList.add("overflow-hidden"),navbarToggler.classList.add("color-transition"),navbarToggler.classList.add("bg-to-red"),navbarToggler.classList.add("burger-to-cross"),headerNav.classList.add("show"),header.classList.remove("sticky-top"),header.classList.add("fixed-stretch"),headerNav.classList.add("opacity-0"),setTimeout(()=>{headerNav.classList.remove("opacity-0")},0),headerNav.querySelector(".navbar-nav").append(headerRutubeLogo),headerRutubeLogo.classList.add("rutube-logo_mobile"),headerNav.querySelector(".navbar-nav").classList.add("align-items-center"),headerLogo.classList.add("flex-grow-1"),headerLogo.style.marginRight=navbarToggler.offsetWidth+"px"}}let link=document.querySelector('[href="#main"]'),scrollListener1;function navLinksFocusMonitoring(){for(let section of SECTIONS)section.getBoundingClientRect().top<30&&section.getBoundingClientRect().bottom>0&&(link=document.querySelector(`[href='#${section.id}']`),link.focus())}function calculateMainHeight(){mainSection.querySelector(".container-xl").offsetHeight>window.innerHeight-header.offsetHeight||(mainSection.style.height=window.innerHeight-header.offsetHeight+"px")}let maxNum=videoRow.children.length,minNum=1,mostLeft=0,mostRight=0,translateRatio,mostLeftVideoCard,mostRightVideoCard,focusedVideoCard;translateRatio=window.innerWidth<576?3:2.5;let videoCardWidth=null,video=null;function addFocusOnVideoCard(card){card.classList.remove("col-lg-4"),card.classList.add("col-lg-5"),card.classList.remove("col-md-6"),card.classList.add("col-md-7"),card.classList.remove("col-sm-7"),card.classList.add("col-sm-8")}function removeFocusOnVideoCard(card){card.classList.add("col-lg-4"),card.classList.remove("col-lg-5"),card.classList.add("col-md-6"),card.classList.remove("col-md-7"),card.classList.add("col-sm-7"),card.classList.remove("col-sm-8")}function videoRowAnalysis(){for(let videoCard of videoCards)videoCard.classList.contains("transition-none")&&videoCard.classList.remove("transition-none"),videoCard.classList.contains("js-begin-here")&&(focusedVideoCard=videoCard,focusedVideoCard.classList.add("focus"),addFocusOnVideoCard(focusedVideoCard),focusedVideoCard.classList.remove("js-begin-here")),videoCardWidth||(videoCardWidth=videoCard.offsetWidth),videoCard.getBoundingClientRect().right>mostRight&&(mostRight=videoCard.getBoundingClientRect().right,mostRightVideoCard=videoCard),videoCard.getBoundingClientRect().left<mostLeft&&(mostLeft=videoCard.getBoundingClientRect().left,mostLeftVideoCard=videoCard)}function holdPanel(){videoRow.style.height=videoRow.offsetHeight+"px"}function translateVideoRowWrapperOnIlussionCardsWidth(){videoRowWrapper.style.transform=`translateX(-${translateRatio*videoCardWidth}px)`}function resetVideoRowHeight(){videoRow.style.height=""}function toPrevVideoCard(multiplier=1){videosSection.removeEventListener("click",videosSectionOnclick),videoRow.classList.remove("transition-none"),videoRow.style.transform=`translateX(${videoCardWidth*multiplier}px)`;let currentElem=focusedVideoCard,prevElem;for(let i=0;i<multiplier;i++){focusedVideoCard.classList.remove("focus"),prevElem=focusedVideoCard.previousElementSibling;let activeCircle=videosSection.querySelector(`[data-videonumind='${focusedVideoCard.dataset.videonum}']`),prevCircle;focusedVideoCard=prevElem,focusedVideoCard.classList.add("focus"),activeCircle.classList.remove("active"),videosSection.querySelector(`[data-videonumind='${focusedVideoCard.dataset.videonum}']`).classList.add("active")}removeFocusOnVideoCard(currentElem),addFocusOnVideoCard(prevElem),setTimeout(()=>{videoRow.classList.add("transition-none"),videoRow.style.transform="";for(let i=0;i<multiplier;i++)videoRow.prepend(mostRightVideoCard),mostLeft=0,mostRight=0,videoRowAnalysis();videosSection.addEventListener("click",videosSectionOnclick),videoRow.ontransitionend=""},400)}function toNextVideoCard(multiplier=1){videosSection.removeEventListener("click",videosSectionOnclick),videoRow.classList.remove("transition-none"),videoRow.style.transform=`translateX(-${videoCardWidth*multiplier}px)`;let currentElem=focusedVideoCard,nextElem;for(let i=0;i<multiplier;i++){focusedVideoCard.classList.remove("focus"),nextElem=focusedVideoCard.nextElementSibling;let activeCircle=videosSection.querySelector(`[data-videonumind='${focusedVideoCard.dataset.videonum}']`),nextCircle;focusedVideoCard=nextElem,focusedVideoCard.classList.add("focus"),activeCircle.classList.remove("active"),videosSection.querySelector(`[data-videonumind='${focusedVideoCard.dataset.videonum}']`).classList.add("active")}removeFocusOnVideoCard(currentElem),addFocusOnVideoCard(nextElem),setTimeout(()=>{videoRow.classList.add("transition-none"),videoRow.style.transform="";for(let i=0;i<multiplier;i++)videoRow.append(mostLeftVideoCard),mostLeft=0,mostRight=0,videoRowAnalysis();videosSection.addEventListener("click",videosSectionOnclick),videoRow.ontransitionend=""},400)}function videosSectionOnclick(event){if(holdPanel(),event.target.closest(".videos__play-video-btn")){videosSection.removeEventListener("click",videosSectionOnclick),html.classList.add("overflow-y-hidden"),modalWindow.classList.remove("d-none");let num=+focusedVideoCard.dataset.videonum;return video=modalWindow.querySelector(`[data-videonum='${num}']`),video.classList.remove("d-none"),void videosSection.addEventListener("click",videosSectionOnclick)}if(event.target.closest(".slide-panel__to-prev-slide")&&toPrevVideoCard(1),event.target.closest(".slide-panel__to-next-slide")&&toNextVideoCard(1),event.target.closest(".slide-panel__indication-circle")){videosSection.removeEventListener("click",videosSectionOnclick);let currentNum=+focusedVideoCard.dataset.videonum,num,n=+event.target.dataset.videonumind-currentNum;if(0==n)return void videosSection.addEventListener("click",videosSectionOnclick);n<0?(n=-n,toPrevVideoCard(n)):toNextVideoCard(n)}if(event.target.closest(".videos__video-card")){if(window.innerWidth<576)return;videosSection.removeEventListener("click",videosSectionOnclick);let videoCard=event.target.closest(".videos__video-card");if(videoCard==focusedVideoCard)return void videosSection.addEventListener("click",videosSectionOnclick);let possibleVideoCard=focusedVideoCard,left,possibleLeft,n=0;if(videoCard.getBoundingClientRect().left<possibleVideoCard.getBoundingClientRect().left){for(;videoCard!=possibleVideoCard;)n++,possibleVideoCard=possibleVideoCard.previousElementSibling;toPrevVideoCard(n)}else{for(;videoCard!=possibleVideoCard;)n++,possibleVideoCard=possibleVideoCard.nextElementSibling;toNextVideoCard(n)}}}function videosSectionOnTouchDown(event){if(event.target.closest(".videos__video-card")){videoRow.classList.add("transition-none");let startX=event.touches[0].clientX,startY=event.touches[0].clientY,diffX,diffY;function videoCardOnTouchMove(event){let moveX=event.touches[0].clientX,moveY=event.touches[0].clientY;diffX=startX-moveX,diffY=startY-moveY,Math.abs(diffY)>=Math.abs(diffX)?document.removeEventListener("touchmove",videoCardOnTouchMove):moveX<0||moveX>window.innerWidth||(videoRow.style.transform=diffX<0?`translateX(${Math.abs(diffX)}px)`:`translateX(-${diffX}px)`)}function swipe(){if(Math.abs(diffX)>=window.innerWidth/2.5)return videosSection.removeEventListener("touchstart",videosSectionOnTouchDown),stopSlide(),diffX<0?toPrevVideoCard(1):toNextVideoCard(1),void setTimeout(()=>{videosSection.addEventListener("touchstart",videosSectionOnTouchDown)},400);stopSlide()}function stopSlide(){videoRow.classList.remove("transition-none"),videoRow.style.transform="",document.removeEventListener("touchmove",videoCardOnTouchMove),document.removeEventListener("touchend",swipe)}document.addEventListener("touchmove",videoCardOnTouchMove),document.addEventListener("touchend",swipe)}}let partnersRowWay=null,startPartnersRowTranslate,partnersRowTranslate,rowWayDuration,rowWayAnimationTime,movingRowAnimation,movingRowAnimationStart=!1,movingRowAnimationStop=!0;function infinityMovingRow_Preload(){startPartnersRowTranslate=0,partnersRowTranslate=0,rowWayDuration=5e3,rowWayAnimationTime=0,partnersRowWay=partnersRow.scrollWidth+10}function stopMovingRow(){let promise;new Promise((resolve,reject)=>{cancelAnimationFrame(movingRowAnimation),resolve()}).then(()=>{startPartnersRowTranslate=partnersRowTranslate+startPartnersRowTranslate,rowWayDuration-=rowWayAnimationTime,partnersRowTranslate=0,window.removeEventListener("scroll",stopMovingRowByScroll),partnersRow.removeEventListener("click",stopMovingRow),partnersRow.addEventListener("click",infinityMovingRow),movingRowAnimationStop=!0,movingRowAnimationStart=!1})}function infinityMovingRow(){if(movingRowAnimationStart&&!movingRowAnimationStop)return;movingRowAnimationStop=!1,movingRowAnimationStart=!0;let start=performance.now();window.removeEventListener("scroll",infinityMovingRowByScroll),window.addEventListener("scroll",stopMovingRowByScroll),partnersRow.addEventListener("click",stopMovingRow),partnersRow.removeEventListener("click",infinityMovingRow),requestAnimationFrame((function infinityMovingRow(time){rowWayAnimationTime=time-start;let timeFraction=rowWayAnimationTime/rowWayDuration,progress;timeFraction>1&&(timeFraction=1),partnersRowTranslate=timeFraction*(partnersRowWay/2-startPartnersRowTranslate),partnersRow.style.transform=`translateX(-${startPartnersRowTranslate+partnersRowTranslate}px)`,timeFraction<1?movingRowAnimation=requestAnimationFrame(infinityMovingRow):(partnersRow.style.transform="translateX(0px)",rowWayDuration=5e3,partnersRowTranslate=0,startPartnersRowTranslate=0,start=performance.now(),requestAnimationFrame(infinityMovingRow))}))}function stopMovingRowByScroll(){(partnersRow.getBoundingClientRect().top>window.innerHeight||partnersRow.getBoundingClientRect().bottom<0)&&stopMovingRow()}function infinityMovingRowByScroll(){partnersRow.getBoundingClientRect().top<window.innerHeight&&partnersRow.getBoundingClientRect().bottom>0&&infinityMovingRow()}function calculateFooterMapHeight(){window.innerHeight<440?footerMap.style.height=.4*footerMap.offsetWidth+"px":window.innerWidth<992&&window.innerWidth>440?footerMap.style.height=.5*footerMap.offsetWidth+"px":footerMap.style.height=footerMap.offsetWidth+"px"}for(let phoneInput of phoneInputs)new IMask(phoneInput,{mask:"+{7} (000)000-00-00"});let startPageYOffset=null,feedbackAppearTimeout=null;function feedbackAppear(){startPageYOffset||(startPageYOffset=window.pageYOffset),Math.abs(window.pageYOffset-startPageYOffset)>=1.5*window.innerHeight&&(feedbackAppearTimeout||(feedbackAppearTimeout=setTimeout(()=>{document.removeEventListener("click",documentOnClick),setTimeout(()=>{document.addEventListener("click",documentOnClick)},2e3),window.removeEventListener("scroll",feedbackAppear),header.classList.add("d-none");const feedbackForm=document.getElementById("feedback-form"),feedbackIntro=document.getElementById("feedback-intro"),feedbackSuccess=document.getElementById("feedback-success"),feedbackOk=document.getElementById("feedback-ok"),feedbackClose=document.getElementById("feedback-close");function closeFeedback(){feedbackForm.classList.remove("d-none"),feedbackIntro.classList.remove("d-none"),feedbackSuccess.classList.add("d-none"),feedback.classList.add("d-none"),modalWindow.querySelector(".iframe-container").classList.remove("d-none"),modalWindow.classList.add("d-none"),header.classList.remove("d-none"),html.classList.remove("overflow-y-hidden")}modalWindow.classList.remove("d-none"),feedback.classList.remove("d-none"),modalWindow.querySelector(".iframe-container").classList.add("d-none"),html.classList.add("overflow-y-hidden"),feedbackClose.onclick=function(){closeFeedback(),header.classList.remove("d-none"),feedbackClose.onclick="",feedbackForm.onsubmit=""},feedbackForm.onsubmit=function(){return feedbackForm.classList.add("d-none"),feedbackIntro.classList.add("d-none"),feedbackSuccess.classList.remove("d-none"),feedbackOk.onclick=function(){closeFeedback(),feedbackOk.onclick=""},feedbackForm.onsubmit="",!1}},3e3)))}function documentOnClick(event){if(event.target==modalWindow){if(video){let src=video.src;video.classList.add("d-none"),video.src="",video.src=src}return html.classList.remove("overflow-y-hidden"),feedback.classList.add("d-none"),header.classList.remove("d-none"),modalWindow.querySelector(".iframe-container").classList.remove("d-none"),void modalWindow.classList.add("d-none")}if(event.target==mainScrollBtn&&window.scrollBy(0,mainSection.offsetHeight-window.pageYOffset),event.target.closest(".js-nav-link ")){if(!(window.innerWidth>=768)){event.preventDefault();let link=event.target.closest(".js-nav-link"),index=link.href.indexOf("#"),sectionId=link.href.slice(index+1,link.href.length),section=document.getElementById(sectionId);headerNav.classList.add("opacity-0"),headerNav.ontransitionend=backDefaultNavbar;let sectionY=section.getBoundingClientRect().top;return window.scrollTo(0,sectionY+window.pageYOffset),!1}{window.removeEventListener("scroll",navLinksFocusMonitoring),event.preventDefault();let link=event.target.closest(".js-nav-link"),index=link.href.indexOf("#"),sectionId=link.href.slice(index+1,link.href.length),section=document.getElementById(sectionId),promise;new Promise((resolve,reject)=>{window.scrollTo(0,section.getBoundingClientRect().top+window.pageYOffset),window.removeEventListener("scroll",navLinksFocusMonitoring),resolve()}).then(()=>{setTimeout(()=>(window.addEventListener("scroll",navLinksFocusMonitoring),!1),1e3)})}}if(event.target.closest("#navbar-toggler"))return headerMobileNavbarBehaviour(),!1}function windowOnLoad(){infinityMovingRow_Preload(),window.addEventListener("scroll",infinityMovingRowByScroll)}calculateMainHeight(),calculateFooterMapHeight(),videoRowAnalysis(),translateVideoRowWrapperOnIlussionCardsWidth(),window.addEventListener("scroll",feedbackAppear),window.innerWidth>=768?(link.focus(),window.addEventListener("scroll",navLinksFocusMonitoring)):window.addEventListener("load",windowOnLoad),window.addEventListener("scroll",headerShrink),videosSection.addEventListener("click",videosSectionOnclick),window.innerWidth<576&&videosSection.addEventListener("touchstart",videosSectionOnTouchDown),document.addEventListener("click",documentOnClick),window.onresize=function(){mainSection.style.height="",calculateMainHeight(),videoRow.classList.remove("transition-none"),resetVideoRowHeight(),translateRatio=2.5,window.innerWidth<576?(translateRatio=3,videosSection.addEventListener("pointerdown",videosSectionOnTouchDown)):videosSection.removeEventListener("pointerdown",videosSectionOnTouchDown),videoCardWidth=null;for(let videoCard of videoCards)videoCard.classList.add("transition-none"),videoCardWidth||(videoCardWidth=videoCard.offsetWidth);translateVideoRowWrapperOnIlussionCardsWidth(),videoRowAnalysis(),calculateFooterMapHeight(),window.innerWidth>768?(headerNav.classList.contains("show")?backDefaultNavbar():headerNav.classList.remove("opacity-0"),window.addEventListener("scroll",navLinksFocusMonitoring),cancelAnimationFrame(movingRowAnimation),partnersRow.style.transform="",window.removeEventListener("scroll",stopMovingRowByScroll),window.removeEventListener("click",stopMovingRow),window.removeEventListener("load",windowOnLoad),partnersRow.removeEventListener("click",infinityMovingRow)):(window.removeEventListener("scroll",navLinksFocusMonitoring),infinityMovingRow_Preload(),window.addEventListener("load",windowOnLoad))};